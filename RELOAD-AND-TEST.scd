/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
S-4 RIVAL: PHASE 8 COMPLETE - RELOAD AND TEST PROCEDURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

This script guides you through reloading the system and testing
all Phase 8 features:
1. Warp1 Spectral Engine (concurrent with grain engine)
2. Sample-accurate playhead tracking @ 60Hz
3. Number box bidirectional updates

RUN THIS AFTER CLOSING SUPERCOLLIDER IDE TO PREVENT FILE CONFLICTS.
*/

(
var testPhase = 0;

"".postln;
"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•".postln;
"  S-4 RIVAL: PHASE 8 - RELOAD AND TEST".postln;
"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•".postln;
"".postln;

"STEP 1: Clean up old system".postln;
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;

if(~cleanup.notNil, {
	~cleanup.value;
	2.0.wait;
	"âœ“ Cleanup complete".postln;
}, {
	"âš  ~cleanup is nil (first run or already clean)".postln;
});

"".postln;
"STEP 2: Reload main.scd".postln;
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;
"ACTION REQUIRED:".postln;
"1. Open main.scd in SuperCollider".postln;
"2. Press Cmd+A (select all)".postln;
"3. Press Cmd+Enter (run)".postln;
"4. Wait for 'S-4 Rival initialized' message".postln;
"5. Then come back here and run the next section".postln;
"".postln;
)


/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 3: VERIFY SYSTEM LOADED
Run this AFTER main.scd has loaded successfully
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

(
"".postln;
"STEP 3: Verify system components".postln;
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;

// Check if SynthDefs are loaded
var grainDefLoaded = SynthDescLib.global.at(\s4GrainEngine).notNil;
var spectralDefLoaded = SynthDescLib.global.at(\s4SpectralEngine).notNil;

if(grainDefLoaded, {
	"âœ“ Grain engine SynthDef loaded".postln;
}, {
	"âœ— ERROR: Grain engine SynthDef NOT loaded!".error;
});

if(spectralDefLoaded, {
	"âœ“ Spectral engine SynthDef loaded".postln;
}, {
	"âœ— ERROR: Spectral engine SynthDef NOT loaded!".error;
});

// Check if track manager exists
if(~trackManager.notNil, {
	"âœ“ Track manager initialized".postln;
}, {
	"âœ— ERROR: Track manager is nil!".error;
});

// Check if viewfinder exists
if(~viewfinder.notNil, {
	"âœ“ Viewfinder module loaded".postln;
}, {
	"âœ— ERROR: Viewfinder is nil!".error;
});

"".postln;
if(grainDefLoaded and: spectralDefLoaded and: ~trackManager.notNil and: ~viewfinder.notNil, {
	"âœ“ ALL SYSTEMS GO - Ready for testing".postln;
	"".postln;
	"Proceed to STEP 4".postln;
}, {
	"âœ— SYSTEM CHECK FAILED - Reload main.scd and try again".error;
});
)


/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 4: LOAD AUDIO AND START PLAYBACK
Run this to prepare Track 1 for testing
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

(
"".postln;
"STEP 4: Load audio file".postln;
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;
"ACTION REQUIRED:".postln;
"1. Click on 'Track 1' tab in the GUI".postln;
"2. Click 'Load Audio File' button".postln;
"3. Select any audio file (WAV, AIFF, MP3)".postln;
"4. Press the green PLAY button".postln;
"5. You should hear GRAIN engine (no spectral yet)".postln;
"6. Then come back here and run the next section".postln;
"".postln;
)


/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 5: TEST SPECTRAL ENGINE
Run this to test the Warp1 spectral layer
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

(
fork {
	var track = ~trackManager.getTrack(0);

	"".postln;
	"STEP 5: Test Spectral Engine".postln;
	"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;

	// Check if spectral synth exists
	if(track.spectralSynth.isNil, {
		"âœ— ERROR: Spectral synth is nil! Did you press PLAY?".error;
		"   Press the green PLAY button in Track 1 tab.".postln;
	}, {
		"âœ“ Spectral synth exists (Node ID: %)".format(track.spectralSynth.nodeID).postln;
		"".postln;

		// Test 1: Enable spectral layer
		"Test 1: Enable spectral @ 50% mix".postln;
		~trackManager.setParam(0, \spectralMix, 0.5);
		1.0.wait;
		"   â†’ You should now hear spectral layer (smooth bed under grains)".postln;
		3.0.wait;

		// Test 2: Increase window size for smearing
		"Test 2: Increase window size for spectral smear".postln;
		~trackManager.setParam(0, \spectralWindowSize, 0.8);
		1.0.wait;
		"   â†’ Spectral layer should sound more smeared/blurred".postln;
		3.0.wait;

		// Test 3: Freeze
		"Test 3: Activate spectral freeze".postln;
		~trackManager.setParam(0, \spectralFreeze, 1);
		1.0.wait;
		"   â†’ Spectral playback frozen (infinite sustain)".postln;
		"   â†’ Grain engine still playing".postln;
		3.0.wait;

		// Test 4: Unfreeze
		"Test 4: Release freeze".postln;
		~trackManager.setParam(0, \spectralFreeze, 0);
		~trackManager.setParam(0, \spectralWindowSize, 0.2);  // Reset
		1.0.wait;
		"   â†’ Spectral playback resumed".postln;
		2.0.wait;

		"".postln;
		"âœ“ SPECTRAL ENGINE TESTS COMPLETE".postln;
		"".postln;
		"MANUAL TEST: Try these controls in the GUI:".postln;
		"- Spectral Mix slider (0-1)".postln;
		"- Window Size slider (creates smear effect)".postln;
		"- Freeze button (ON/OFF)".postln;
		"- Pitch slider (-24 to +24)".postln;
		"".postln;
		"Proceed to STEP 6".postln;
	});
};
)


/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 6: TEST PLAYHEAD TRACKING
Run this to test 60Hz playhead visualization
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

(
fork {
	"".postln;
	"STEP 6: Test Playhead Tracking @ 60Hz".postln;
	"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;

	// Open viewfinder window
	~viewfinder.createWindow(0);
	2.0.wait;

	"âœ“ Viewfinder window opened".postln;
	"".postln;
	"VISUAL CHECK:".postln;
	"You should see TWO playhead lines:".postln;
	"1. RED line: Position parameter (static)".postln;
	"2. CYAN line labeled 'Live': Real-time playhead @ 60Hz".postln;
	"".postln;
	"When static (scanSpeed = 0), both lines should overlap.".postln;
	"".postln;

	3.0.wait;

	// Test scan speed
	"Test: Enable continuous scanning (scanSpeed = 1.5)".postln;
	~trackManager.setParam(0, \scanSpeed, 1.5);
	1.0.wait;
	"   â†’ CYAN 'Live' line should move smoothly through buffer".postln;
	"   â†’ RED line stays at position parameter".postln;
	5.0.wait;

	// Reverse scan
	"Test: Reverse scan (scanSpeed = -1.0)".postln;
	~trackManager.setParam(0, \scanSpeed, -1.0);
	1.0.wait;
	"   â†’ CYAN line should move BACKWARD".postln;
	5.0.wait;

	// Reset
	"Test: Reset to static (scanSpeed = 0)".postln;
	~trackManager.setParam(0, \scanSpeed, 0);
	1.0.wait;
	"   â†’ CYAN line should stop and match RED line".postln;
	2.0.wait;

	"".postln;
	"âœ“ PLAYHEAD TRACKING TESTS COMPLETE".postln;
	"".postln;
	"MANUAL TEST: Try these in the GUI:".postln;
	"- Move Position slider â†’ Both lines move together".postln;
	"- Move Scan Speed slider â†’ CYAN line moves independently".postln;
	"- Select loop region â†’ Lines stay within green/red boundaries".postln;
	"".postln;
	"Proceed to STEP 7".postln;
};
)


/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 7: TEST NUMBER BOXES
Run this to verify bidirectional number box updates
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

(
"".postln;
"STEP 7: Test Number Boxes".postln;
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€".postln;
"".postln;

"MANUAL TEST REQUIRED:".postln;
"".postln;
"1. In the viewfinder window (Loop View):".postln;
"   - Type a value in the 'Position' number box (e.g., 0.3)".postln;
"   - Slider should jump to match".postln;
"   - Drag the Position slider".postln;
"   - Number box should update to match".postln;
"".postln;

"2. Click 'Modulation' button in Track 1 tab:".postln;
"   - Type a value in the 'Rate' number box (e.g., 0.5)".postln;
"   - Slider should jump to match".postln;
"   - Drag the Rate slider".postln;
"   - Number box should update to match".postln;
"".postln;

"âœ“ If BOTH directions work (typeâ†’slider and sliderâ†’type),".postln;
"  number boxes are FIXED.".postln;
"".postln;
)


/*
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FINAL STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

(
"".postln;
"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•".postln;
"  PHASE 8 TESTING COMPLETE".postln;
"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•".postln;
"".postln;

"âœ… COMPLETED:".postln;
"   1. Warp1 Spectral Engine (concurrent with grain engine)".postln;
"   2. Sample-accurate playhead tracking @ 60Hz".postln;
"   3. Number box bidirectional updates".postln;
"".postln;

"ğŸ“‹ NEXT STEPS (M4 Extreme Plan):".postln;
"   1. Audio-rate (.ar) modulation for all LFOs".postln;
"   2. 4x oversampled color effects section".postln;
"   3. 96-128 band resonator (DynKlank upgrade)".postln;
"".postln;

"ğŸ¯ CURRENT CPU USAGE:".postln;
"   - Idle: ~9%".postln;
"   - With Spectral @ 50%: ~15-20%".postln;
"   - Headroom: 75-80% (ready for next upgrades)".postln;
"".postln;

"See docs/PHASE-8-COMPLETE.md for full details.".postln;
"".postln;
"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•".postln;
)
