# BEARULATOR v2.4 - Plugin Status & Fallback Behavior

**Date:** 2026-01-27  
**Status:** âœ… **Working** (uses fallback algorithms without plugins)

---

## Current Behavior

v2.4 is **fully functional** without any additional plugins. All new features work using fallback algorithms:

| Feature | Plugin UGen | Fallback Algorithm | Quality Difference |
|---------|------------|-------------------|-------------------|
| **Barberpole Phaser** | FreqShift (core) | N/A - core UGen | âœ… Full quality (no plugin needed) |
| **Acid Filter** | VADiodeFilter | MoogFF | âš ï¸ Similar but less "acidic" |
| **Rings Resonator** | MiRings | BPF (resonant bandpass) | âš ï¸ Basic resonance, no physical modeling |
| **Squiz Artifacts** | Squiz | Bitcrush (Latch + Impulse) | âš ï¸ Similar aliasing, less "crushed" |
| **Greyhole Reverb** | Greyhole | FreeVerb | âš ï¸ Less diffuse, shorter tails |

---

## Why Fallbacks?

SuperCollider's SynthDef compilation happens **at load time**, not runtime. You can't conditionally use a class that doesn't exist - the compiler will fail with "Class not defined" before the SynthDef is even created.

**Three Solutions:**

### 1. âœ… **Current Approach: Safe Fallbacks** (Implemented)
- **Pros:** Works for everyone, no installation required
- **Cons:** Not the "full" v2.4 sound

### 2. âš ï¸ **Conditional Compilation** (Complex)
- Build multiple SynthDefs and choose at load time
- Requires significant refactoring
- Maintenance burden (two codebases)

### 3. ðŸ’¡ **Manual Plugin Upgrade** (User Choice)
- Install plugins, manually edit grain-engine.scd
- Full control, best quality
- Documented below

---

## How to Enable Full Plugin Support

If you have sc3-plugins and mi-UGens installed, you can manually upgrade to the "true" v2.4:

### Step 1: Install Plugins

```supercollider
// In SuperCollider:
Quarks.install("sc3-plugins");
Quarks.install("https://github.com/v7b1/mi-UGens");

// For Greyhole, increase server memory:
s.options.memSize = 65536;
s.reboot;
```

### Step 2: Verify Installation

```supercollider
// Check if plugins loaded:
\VADiodeFilter.asClass.notNil; // Should return true
\Squiz.asClass.notNil;         // Should return true
\Greyhole.asClass.notNil;      // Should return true
\MiRings.asClass.notNil;       // Should return true
```

### Step 3: Edit grain-engine.scd

Open `core/grain-engine.scd` and make these replacements:

#### A. VADiodeFilter (Line ~342)
**Replace:**
```supercollider
diodeFilter = MoogFF.ar(driven, freq, filterRes.linlin(0, 1, 0, 3.5));
```

**With:**
```supercollider
diodeFilter = VADiodeFilter.ar(driven, freq, filterRes.linlin(0, 1, 0, 0.95), 0);
```

#### B. MiRings (Line ~345)
**Replace:**
```supercollider
ringsFilter = BPF.ar(driven, freq, rq) * 2;
```

**With:**
```supercollider
ringsFilter = {
    var rtrig = Impulse.ar(20);
    MiRings.ar(driven,
        rtrig: rtrig,
        rfreq: freq,
        rstruct: filterRes,
        rbright: ringsBright,
        rdamp: ringsDamp,
        rpos: ringsPos,
        rmodel: ringsModel.clip(0, 5),
        rpoly: 4,
        rintern_exciter: 0,
        reasteregg: 0,
        rbypass: 0
    )
}.value;
```

#### C. Squiz (Line ~383)
**Replace:**
```supercollider
squizzed = Latch.ar(colored, Impulse.ar(48000 / squizAmount.linexp(1, 10, 1, 20)));
```

**With:**
```supercollider
squizzed = Squiz.ar(colored, squizAmount.linexp(1, 10, 1, 20));
```

#### D. Greyhole (Line ~414)
**Replace:**
```supercollider
// Reverb: FreeVerb or Greyhole (requires sc3-plugins)
// Note: Using FreeVerb for both modes until sc3-plugins installed
// reverbType parameter exists but currently both use FreeVerb
wet = [
    FreeVerb.ar(spaced[0], 1.0, reverbSize * freezeGain, reverbDamp),
    FreeVerb.ar(spaced[1], 1.0, reverbSize * freezeGain, reverbDamp)
];
```

**With:**
```supercollider
// Reverb: FreeVerb or Greyhole
var freeverbWet = [
    FreeVerb.ar(spaced[0], 1.0, reverbSize * freezeGain, reverbDamp),
    FreeVerb.ar(spaced[1], 1.0, reverbSize * freezeGain, reverbDamp)
];

var greyholeWet = [
    Greyhole.ar(spaced[0],
        delayTime: reverbSize.linexp(0.01, 1, 0.1, 5.0),
        dampingfreq: reverbDamp.linexp(0.01, 1, 200, 10000),
        size: 1.0,
        feedback: reverbFreeze.linexp(0.01, 1, 0.7, 0.99),
        modDepth: 0.1,
        modFreq: 2.0
    ),
    Greyhole.ar(spaced[1],
        delayTime: reverbSize.linexp(0.01, 1, 0.1, 5.0),
        dampingfreq: reverbDamp.linexp(0.01, 1, 200, 10000),
        size: 1.0,
        feedback: reverbFreeze.linexp(0.01, 1, 0.7, 0.99),
        modDepth: 0.1,
        modFreq: 2.0
    )
];

wet = SelectX.ar(reverbType.clip(0, 1).lag(0.05), [
    freeverbWet,
    greyholeWet
]);
```

### Step 4: Reload

```supercollider
s.reboot;
"main.scd".loadRelative;
```

---

## Testing Plugin Version

After upgrading, run the v2.4 test:

```supercollider
"tests/v2.4-deployment-test.scd".loadRelative;
```

You should see:
```
âœ“ sc3-plugins installed (VADiodeFilter available)
  â†’ VADiodeFilter UGen found
âœ“ sc3-plugins installed (Squiz available)
  â†’ Squiz UGen found
âœ“ sc3-plugins installed (Greyhole available)
  â†’ Greyhole UGen found
âœ“ mi-UGens installed (MiRings available)
  â†’ MiRings UGen found
```

---

## Sound Quality Comparison

### Acid Filter (filterType=1)
**Fallback (MoogFF):**
- Smooth, musical ladder filter
- Good resonance but not as "screamy"
- Safe for all bass frequencies

**Plugin (VADiodeFilter):**
- TB-303 diode ladder emulation
- Aggressive self-oscillation
- Characteristic "squelch" at high resonance
- Can be unstable (in a good way!)

### Rings Resonator (filterType=2)
**Fallback (BPF):**
- Simple bandpass resonance
- Fixed decay time
- No physical modeling

**Plugin (MiRings):**
- 6 resonator models (modal, strings, bowed, blown, struck)
- Physical modeling with realistic decay
- Brightness, damping, position controls
- Rich harmonic content

### Squiz (squizMix > 0)
**Fallback (Bitcrush):**
- Basic aliasing via sample rate reduction
- Predictable, lo-fi texture

**Plugin (Squiz):**
- Wave squeezing algorithm
- More aggressive digital artifacts
- IDM-style "crushed" timbre

### Greyhole (reverbType=1)
**Fallback (FreeVerb):**
- Classic Schroeder reverb
- Clean, short-medium tails
- Low CPU (~1%)

**Plugin (Greyhole):**
- Diffusion-based blackhole reverb
- Infinite, evolving tails
- Eventide Space-style spaces
- Higher CPU (~5%)

---

## Recommendation

**For most users:** The fallback version is perfectly usable and provides 90% of the v2.4 experience.

**Upgrade to plugins if you:**
1. Want the most authentic TB-303 acid sound (VADiodeFilter)
2. Need physical modeling resonance (MiRings)
3. Require massive infinite reverb spaces (Greyhole)
4. Are experimenting with extreme IDM textures (Squiz)

---

## Future Enhancement

A potential v2.5 could include:
- Automated plugin detection + conditional SynthDef loading
- GUI indicators showing which version of each effect is active
- "Upgrade Available" notifications when plugins detected

For now, the manual approach works reliably and gives users full control.

---

**Last Updated:** 2026-01-27  
**Affects:** BEARULATOR v2.4
